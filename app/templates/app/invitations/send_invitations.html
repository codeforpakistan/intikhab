{% extends 'app/layouts/page.html' %}

{% block content %}
<!-- Header Section -->
<header class="bg-primary text-white py-4 mb-0">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h1 class="mb-0">Send Invitations</h1>
        <p class="lead mb-0">{{ election.name }}</p>
      </div>
      <div>
        <span class="badge bg-warning text-dark">
          <i class="bi bi-lock me-1"></i>Private Election
        </span>
      </div>
    </div>
  </div>
</header>

{% include 'app/partials/breadcrumbs.html' %}

<!-- Content Section -->
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      
      <!-- Information Card -->
      <div class="alert alert-info mb-4">
        <h5 class="alert-heading">
          <i class="bi bi-info-circle me-2"></i>About Private Election Invitations
        </h5>
        <p class="mb-0">
          Send email invitations to specific people you want to participate in this private election. 
          They will receive an email with a secure link to accept or decline the invitation.
        </p>
      </div>

      <!-- Send Invitations Form -->
      <div class="card border-0">
        <div class="card-header border-0">
          <h4 class="card-title mb-0">
            <i class="bi bi-envelope-plus me-2"></i>Send New Invitations
          </h4>
        </div>
        <div class="card-body">
          <form method="post">
            {% csrf_token %}
            
            <!-- Email Addresses Field -->
            <div class="mb-4">
              <label for="{{ form.invited_emails.id_for_label }}" class="form-label">
                {{ form.invited_emails.label }}
              </label>
              {{ form.invited_emails }}
              {% if form.invited_emails.help_text %}
                <div class="form-text">{{ form.invited_emails.help_text }}</div>
              {% endif %}
              {% if form.invited_emails.errors %}
                <div class="text-danger">
                  {% for error in form.invited_emails.errors %}
                    <small>{{ error }}</small>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Expiration Days Field -->
            <div class="mb-4">
              <label for="{{ form.expires_in_days.id_for_label }}" class="form-label">
                {{ form.expires_in_days.label }}
              </label>
              {{ form.expires_in_days }}
              {% if form.expires_in_days.help_text %}
                <div class="form-text">{{ form.expires_in_days.help_text }}</div>
              {% endif %}
              {% if form.expires_in_days.errors %}
                <div class="text-danger">
                  {% for error in form.expires_in_days.errors %}
                    <small>{{ error }}</small>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Personal Message Field -->
            <div class="mb-4">
              <label for="{{ form.message.id_for_label }}" class="form-label">
                {{ form.message.label }}
              </label>
              {{ form.message }}
              {% if form.message.help_text %}
                <div class="form-text">{{ form.message.help_text }}</div>
              {% endif %}
              {% if form.message.errors %}
                <div class="text-danger">
                  {% for error in form.message.errors %}
                    <small>{{ error }}</small>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-between">
              <a href="{% url 'election_detail' uuid=election.uuid %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Back to Election
              </a>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-send me-2"></i>Send Invitations
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Current Invitations Summary -->
      {% if election.invitations.count > 0 %}
      <div class="card border-0 mt-4">
        <div class="card-header border-0">
          <h5 class="card-title mb-0">
            <i class="bi bi-people me-2"></i>Current Invitations
          </h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-4">
              <div class="h4 text-warning">{{ election.get_pending_invitations_count }}</div>
              <small class="text-muted">Pending</small>
            </div>
            <div class="col-4">
              <div class="h4 text-success">{{ election.get_accepted_invitations_count }}</div>
              <small class="text-muted">Accepted</small>
            </div>
            <div class="col-4">
              <div class="h4 text-secondary">{{ election.invitations.count }}</div>
              <small class="text-muted">Total</small>
            </div>
          </div>
          <div class="text-center mt-3">
            <a href="{% url 'manage_invitations' uuid=election.uuid %}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-gear me-2"></i>Manage All Invitations
            </a>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}